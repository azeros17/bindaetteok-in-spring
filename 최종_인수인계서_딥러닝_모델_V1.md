# 📘 어울링 12시간 딥러닝 예측 및 배차 시스템 인수인계서

## 1. 프로젝트 개요
본 모듈은 기존의 '30분 단기 예측(SOPA)'의 한계를 극복하고, **12시간 후의 자전거 수요를 미리 예측**하여 선제적으로 재배치하기 위해 구축되었습니다.
단순한 머신러닝(Random Forest)을 넘어, 시계열 데이터의 흐름(Sequence)을 학습하는 **PyTorch 기반 LSTM(Long Short-Term Memory)** 모델을 도입했습니다.

---

## 2. 핵심 성과 (Performance)
실제 2023-2024년 데이터로 학습하고, 2025년 1~2분기 데이터로 검증한 결과입니다.

| 구분 | 기존 모델 (Random Forest) | **신규 모델 (LSTM Deep Learning)** | 비고 |
| :--- | :---: | :---: | :--- |
| **정확도 (RMSE)** | 18.22 | **11.90** | **오차 35% 감소** |
| **운영 방식** | 단기 대응 (30분 전 알림) | **장기 선제 조치 (12시간 전 배차)** | 골든타임 확보 |
| **특이사항** | 단순 합산 예측 | 출퇴근/점심/심야 **시퀀스 패턴** 학습 | 시나리오 기반 |

---

## 3. 시스템 구조 (Architecture)

### 3.1. 데이터 파이프라인 (Data Pipeline)
*   **Source**: 전체 CSV 히스토리 (2023 ~ 2025)
*   **Preprocessing**: `DataProcessor` 클래스가 시간을 '시퀀스(24시간)'로 변환하고 13가지 시나리오 피처(출퇴근, 블랙홀, 업힐 등)를 주입합니다.

### 3.2. 예측 엔진 (Prediction Engine)
*   **Model**: `OulringLSTM` (PyTorch)
*   **Knowledge Base (Brain)**: 2023~2024년 전체 데이터에서 학습된 **요일별/계절별/시간대별 표준 패턴 (Weights)**.
*   **Input (Trigger)**:
    1.  **Temporal Context**: "오늘은 무슨 요일인가?" (Day of Week, Weekend Flag)
    2.  **Recent Trend (24h)**: "현재 이용량 수준은 어떤가?" (최근 24시간의 대여/반납 추세)
*   **Output**: 학습된 과거 패턴에 현재 추세를 대입하여 계산한 **향후 12시간 Net Flow**.

### 3.3. 배차 최적화 (Optimization)
*   **Logic**: 예측된 부족분(Deficit)과 잉여분(Surplus)을 바탕으로, **VRP(Vehicle Routing Problem)** 알고리즘이 트럭의 최적 이동 경로를 생성합니다.
*   **Action**: "단순 보충"이 아닌, **"잉여 대여소에서 수거 → 부족 대여소로 공급"**하는 유기적 동선을 짭니다.

---

## 4. 주요 파일 설명 (Key Files)

| 파일 경로 | 역할 및 설명 |
| :--- | :--- |
| `backend/lstm_predictor.py` | **[핵심] LSTM 모델 정의 및 학습 코드**.<br>- `DataProcessor`: 13개 시나리오 피처 생성<br>- `OulringLSTM`: PyTorch 모델 아키텍처<br>- `run_lstm_training`: 학습 및 평가 실행 함수 |
| `backend/simulate_lstm_route.py` | **[통합 시뮬레이션]**.<br>LSTM 모델의 예측값과 `VRPDispatcher`를 연동하여, 실제 트럭이 수행해야 할 **작업 지시서(Route Plan)**를 출력합니다. |
| `backend/vrp_dispatcher.py` | **[경로 최적화]**.<br>다수의 대여소와 트럭 위치를 고려하여, 이동 거리를 최소화하는 배차 동선을 계산합니다. |
| `backend/simulate_lstm_relocation.py` | **[단위 테스트]**.<br>특정 대여소(예: 세종시청)에 대해 LSTM 모델이 정확히 동작하는지 단건 예측을 수행합니다. |

---

## 5. 실행 및 운영 가이드 (User Guide)

### 5.1. 환경 설정
CPU 환경에서도 충분히 학습 및 실행이 가능하도록 최적화되어 있습니다.
```bash
# PyTorch 설치 (CPU 버전도 가능)
pip install torch torchvision torchaudio pandas scikit-learn
```

### 5.2. 모델 학습 (Training)
전체 데이터를 재학습시키려면 아래 명령어를 실행합니다. (약 3~5분 소요)
```bash
python backend/lstm_predictor.py
```
> **결과**: 학습이 완료되면 2025년 데이터에 대한 RMSE 점수가 출력됩니다.

### 5.3. 배차 시뮬레이션 (Simulation)
"지금 트럭을 어디로 보내야 해?"에 대한 답을 얻으려면:
```bash
python backend/simulate_lstm_route.py
```
> **출력 예시**:
> ```
> [Truck_A Route Plan]
> 1. COLLECT 15 bikes @ 호수공원 (Hotspot)
> 2. SUPPLY 15 bikes @ 세종시청 (Blackhole)
> ```

---

## 6. 향후 확장 계획 (Next Steps)
1.  **날씨 정보 연동 (Weather Integration)**: 현재는 시간 정보만 사용하므로, 기상청 API를 연동해 `is_raining` 피처를 추가해야 합니다. (폭우 시 수요 급감 반영 필요)
2.  **공휴일 로직 적용 완료 (Holiday Logic Implemented)**: 한국의 주요 공휴일(2023-2025)을 하드코딩하여, 평일 공휴일에도 '주말/레저' 패턴이 적용되도록 **수정 완료**했습니다. (광복절 출근 대란 방지)
3.  **권역 확장**: 생활권 단위의 거시적 밸런싱 로직 추가.

---
**작성일**: 2026-01-10
**작성자**: Oulring AI Assistant
